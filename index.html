<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sign Language - Word Recognition</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #0a0a0a;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .bg-dark {
            background: #111111;
        }
        
        .bg-darker {
            background: #0d0d0d;
        }
        
        .card {
            background: linear-gradient(145deg, #1a1a1a, #151515);
            border: 1px solid #252525;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:active {
            transform: scale(0.98);
        }
        
        #videoContainer {
            position: relative;
            width: 100%;
            aspect-ratio: 4/3;
            background: #000;
            overflow: hidden;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }
        
        .word-badge {
            animation: wordPop 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes wordPop {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }
        
        .btn {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #7c3aed, #4f46e5);
        }
        
        .btn-secondary {
            background: #1f1f1f;
            border: 1px solid #2a2a2a;
        }
        
        .btn-secondary:hover {
            background: #252525;
            border-color: #333;
        }
        
        .scroll-container {
            scrollbar-width: thin;
            scrollbar-color: #333 transparent;
        }
        
        .scroll-container::-webkit-scrollbar {
            width: 4px;
        }
        
        .scroll-container::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .scroll-container::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 2px;
        }
        
        .word-chip {
            background: linear-gradient(135deg, #1e1e1e, #181818);
            border: 1px solid #2a2a2a;
            transition: all 0.2s ease;
        }
        
        .word-chip:active {
            background: linear-gradient(135deg, #252525, #1f1f1f);
        }
        
        .gesture-card {
            background: #161616;
            border: 1px solid #222;
            transition: all 0.2s ease;
        }
        
        .gesture-card:active {
            background: #1a1a1a;
            border-color: #8b5cf6;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #141414 100%);
            border-left: 3px solid #8b5cf6;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="text-white">
    <div class="max-w-7xl mx-auto px-4 py-4 md:py-6">
        <!-- Header -->
        <div class="card rounded-2xl p-4 md:p-6 mb-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl md:text-4xl font-bold gradient-text mb-1">
                        Sign Language
                    </h1>
                    <p class="text-gray-400 text-sm md:text-base">One gesture, one word - instant speech</p>
                </div>
                <button id="menuBtn" class="btn btn-secondary p-3 rounded-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-4">
            <!-- Main Camera Section -->
            <div class="lg:col-span-2 space-y-4">
                <!-- Video Feed -->
                <div class="card rounded-2xl overflow-hidden">
                    <div id="videoContainer" class="relative">
                        <video id="video" autoplay playsinline muted></video>
                        <canvas id="canvas"></canvas>
                        
                        <!-- Status Indicator -->
                        <div class="absolute top-3 right-3 bg-black bg-opacity-60 backdrop-blur-sm px-3 py-2 rounded-full flex items-center gap-2">
                            <div id="statusDot" class="w-2 h-2 rounded-full bg-red-500"></div>
                            <span id="statusText" class="text-xs font-medium">Ready</span>
                        </div>
                        
                        <!-- Current Word Display -->
                        <div id="currentWord" class="absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black via-black to-transparent hidden">
                            <div class="text-center">
                                <div class="text-sm text-gray-400 mb-2">Detected</div>
                                <div class="text-5xl md:text-7xl font-bold word-badge" id="wordDisplay">-</div>
                            </div>
                        </div>
                        
                        <!-- Gesture Hint -->
                        <div id="gestureHint" class="absolute top-3 left-3 bg-purple-600 bg-opacity-20 backdrop-blur-sm px-4 py-2 rounded-xl border border-purple-500 border-opacity-30">
                            <div class="text-xs text-purple-300">üëã Show a gesture</div>
                        </div>
                    </div>
                    
                    <!-- Camera Controls -->
                    <div class="p-4 bg-darker border-t border-gray-800">
                        <div class="flex gap-2">
                            <button id="startBtn" class="btn btn-primary flex-1 py-3 rounded-xl font-semibold text-sm md:text-base">
                                üì∏ Start Camera
                            </button>
                            <button id="stopBtn" class="btn btn-secondary flex-1 py-3 rounded-xl font-semibold text-sm md:text-base opacity-50" disabled>
                                ‚è∏Ô∏è Stop
                            </button>
                            <button id="flipBtn" class="btn btn-secondary p-3 rounded-xl" disabled>
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sentence Builder -->
                <div class="card rounded-2xl p-4 md:p-6">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-lg md:text-xl font-bold">Your Sentence</h2>
                        <div class="flex gap-2">
                            <button id="speakBtn" class="btn btn-secondary px-4 py-2 rounded-lg text-sm font-medium" disabled>
                                üîä Speak
                            </button>
                            <button id="clearSentenceBtn" class="btn btn-secondary px-4 py-2 rounded-lg text-sm font-medium">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <div id="sentenceDisplay" class="bg-darker rounded-xl p-4 min-h-[80px] text-lg md:text-2xl font-medium border border-gray-800 mb-4">
                        <span class="text-gray-500">Start signing to build your sentence...</span>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="flex gap-2 overflow-x-auto pb-2 scroll-container">
                        <button class="btn btn-secondary px-4 py-2 rounded-lg text-sm whitespace-nowrap" onclick="copyToClipboard()">
                            üìã Copy
                        </button>
                        <button class="btn btn-secondary px-4 py-2 rounded-lg text-sm whitespace-nowrap" onclick="shareText()">
                            üì§ Share
                        </button>
                        <button class="btn btn-secondary px-4 py-2 rounded-lg text-sm whitespace-nowrap" onclick="downloadText()">
                            üíæ Save
                        </button>
                        <button class="btn btn-secondary px-4 py-2 rounded-lg text-sm whitespace-nowrap" onclick="translateText()">
                            üåê Translate
                        </button>
                    </div>
                </div>

                <!-- Quick Phrases -->
                <div class="card rounded-2xl p-4 md:p-6">
                    <h2 class="text-lg font-bold mb-3">Quick Phrases</h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                        <button class="word-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="addQuickPhrase('Good morning')">
                            ‚òÄÔ∏è Good morning
                        </button>
                        <button class="word-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="addQuickPhrase('Thank you')">
                            üôè Thank you
                        </button>
                        <button class="word-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="addQuickPhrase('I need help')">
                            üÜò I need help
                        </button>
                        <button class="word-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="addQuickPhrase('How are you?')">
                            üí≠ How are you?
                        </button>
                        <button class="word-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="addQuickPhrase('See you later')">
                            üëã See you later
                        </button>
                        <button class="word-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="addQuickPhrase('I love you')">
                            ‚ù§Ô∏è I love you
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-4">
                <!-- Statistics -->
                <div class="card rounded-2xl p-4 md:p-6">
                    <h2 class="text-lg font-bold mb-4">Session Stats</h2>
                    <div class="space-y-3">
                        <div class="stat-card p-3 rounded-lg">
                            <div class="text-2xl font-bold gradient-text" id="wordCount">0</div>
                            <div class="text-xs text-gray-400 mt-1">Words Detected</div>
                        </div>
                        <div class="stat-card p-3 rounded-lg">
                            <div class="text-2xl font-bold text-green-400" id="accuracy">100%</div>
                            <div class="text-xs text-gray-400 mt-1">Accuracy</div>
                        </div>
                        <div class="stat-card p-3 rounded-lg">
                            <div class="text-2xl font-bold text-blue-400" id="sessionTime">0:00</div>
                            <div class="text-xs text-gray-400 mt-1">Session Time</div>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="card rounded-2xl p-4 md:p-6">
                    <h2 class="text-lg font-bold mb-4">Settings</h2>
                    
                    <div class="space-y-4">
                        <!-- Speech Rate -->
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Speech Speed</label>
                            <input type="range" id="speechRate" min="0.5" max="2" step="0.1" value="1" 
                                   class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-600">
                            <div class="text-xs text-gray-500 mt-1" id="rateValue">1.0x Normal</div>
                        </div>
                        
                        <!-- Voice Selection -->
                        <div>
                            <label class="text-sm text-gray-400 mb-2 block">Voice</label>
                            <select id="voiceSelect" class="w-full bg-darker border border-gray-700 rounded-lg px-3 py-2 text-sm">
                                <option>Loading voices...</option>
                            </select>
                        </div>
                        
                        <!-- Auto Options -->
                        <div class="space-y-2">
                            <label class="flex items-center gap-3 cursor-pointer p-2 rounded-lg hover:bg-darker">
                                <input type="checkbox" id="autoSpeak" class="w-4 h-4 accent-purple-600">
                                <span class="text-sm">Auto-speak words</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer p-2 rounded-lg hover:bg-darker">
                                <input type="checkbox" id="showLandmarks" checked class="w-4 h-4 accent-purple-600">
                                <span class="text-sm">Show hand tracking</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer p-2 rounded-lg hover:bg-darker">
                                <input type="checkbox" id="autoSpace" checked class="w-4 h-4 accent-purple-600">
                                <span class="text-sm">Auto-add spaces</span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer p-2 rounded-lg hover:bg-darker">
                                <input type="checkbox" id="vibrate" checked class="w-4 h-4 accent-purple-600">
                                <span class="text-sm">Vibration feedback</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Gesture Guide -->
                <div class="card rounded-2xl p-4 md:p-6">
                    <h2 class="text-lg font-bold mb-4">Gesture Guide</h2>
                    <div class="space-y-2 max-h-[400px] overflow-y-auto scroll-container">
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üëã</div>
                                <div>
                                    <div class="font-medium text-sm">Hello</div>
                                    <div class="text-xs text-gray-400">Open hand wave</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üëç</div>
                                <div>
                                    <div class="font-medium text-sm">Yes / Good</div>
                                    <div class="text-xs text-gray-400">Thumbs up</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üëé</div>
                                <div>
                                    <div class="font-medium text-sm">No / Bad</div>
                                    <div class="text-xs text-gray-400">Thumbs down</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">‚úåÔ∏è</div>
                                <div>
                                    <div class="font-medium text-sm">Peace / Okay</div>
                                    <div class="text-xs text-gray-400">Peace sign</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">‚úã</div>
                                <div>
                                    <div class="font-medium text-sm">Stop / Wait</div>
                                    <div class="text-xs text-gray-400">Open palm forward</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üëå</div>
                                <div>
                                    <div class="font-medium text-sm">Okay / Perfect</div>
                                    <div class="text-xs text-gray-400">OK sign</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">ü§ô</div>
                                <div>
                                    <div class="font-medium text-sm">Call / Contact</div>
                                    <div class="text-xs text-gray-400">Hang loose gesture</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üôè</div>
                                <div>
                                    <div class="font-medium text-sm">Please / Thanks</div>
                                    <div class="text-xs text-gray-400">Hands together</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">ü§ò</div>
                                <div>
                                    <div class="font-medium text-sm">Love / Rock</div>
                                    <div class="text-xs text-gray-400">Rock hand sign</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">‚úä</div>
                                <div>
                                    <div class="font-medium text-sm">Strong / Fight</div>
                                    <div class="text-xs text-gray-400">Closed fist</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üëâ</div>
                                <div>
                                    <div class="font-medium text-sm">You / That</div>
                                    <div class="text-xs text-gray-400">Pointing finger</div>
                                </div>
                            </div>
                        </div>
                        <div class="gesture-card p-3 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">ü§ö</div>
                                <div>
                                    <div class="font-medium text-sm">I / Me</div>
                                    <div class="text-xs text-gray-400">Point to yourself</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- History -->
                <div class="card rounded-2xl p-4 md:p-6">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-lg font-bold">Word History</h2>
                        <button onclick="clearHistory()" class="text-xs text-gray-400 hover:text-white">Clear</button>
                    </div>
                    <div id="wordHistory" class="space-y-2 max-h-[300px] overflow-y-auto scroll-container">
                        <div class="text-sm text-gray-500 text-center py-4">No words detected yet</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let hands;
        let camera;
        let sentence = [];
        let detectedWords = [];
        let lastDetectedWord = '';
        let lastDetectionTime = 0;
        let isRunning = false;
        let sessionStartTime = null;
        let wordCount = 0;
        let facingMode = 'user';
        let voices = [];

        // DOM elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const flipBtn = document.getElementById('flipBtn');
        const speakBtn = document.getElementById('speakBtn');
        const clearSentenceBtn = document.getElementById('clearSentenceBtn');
        const sentenceDisplay = document.getElementById('sentenceDisplay');
        const currentWordEl = document.getElementById('currentWord');
        const wordDisplayEl = document.getElementById('wordDisplay');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const wordCountEl = document.getElementById('wordCount');
        const sessionTimeEl = document.getElementById('sessionTime');
        const wordHistoryEl = document.getElementById('wordHistory');
        const speechRateInput = document.getElementById('speechRate');
        const rateValueEl = document.getElementById('rateValue');
        const voiceSelect = document.getElementById('voiceSelect');
        const autoSpeakCheck = document.getElementById('autoSpeak');
        const showLandmarksCheck = document.getElementById('showLandmarks');
        const autoSpaceCheck = document.getElementById('autoSpace');
        const vibrateCheck = document.getElementById('vibrate');

        // Load voices
        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
            if (voices.length > 0) {
                voiceSelect.innerHTML = '';
                voices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (voice.default) {
                        option.selected = true;
                    }
                    voiceSelect.appendChild(option);
                });
            }
        }

        // Load voices on page load and when they change
        loadVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        // Update UI values
        speechRateInput.addEventListener('input', (e) => {
            const rate = parseFloat(e.target.value);
            let label = 'Normal';
            if (rate < 1) label = 'Slow';
            else if (rate > 1) label = 'Fast';
            rateValueEl.textContent = `${rate.toFixed(1)}x ${label}`;
        });

        // MediaPipe Hands setup
        function initializeMediaPipe() {
            hands = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });

            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: 1,
                minDetectionConfidence: 0.7,
                minTrackingConfidence: 0.5
            });

            hands.onResults(onResults);
        }

        // Process hand detection results
        function onResults(results) {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            ctx.save();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                
                if (showLandmarksCheck.checked) {
                    drawHandLandmarks(landmarks);
                }
                
                const word = recognizeWord(landmarks);
                if (word) {
                    handleDetectedWord(word);
                }
            } else {
                currentWordEl.classList.add('hidden');
            }
            
            ctx.restore();
        }

        // Draw hand landmarks
        function drawHandLandmarks(landmarks) {
            const connections = [
                [0,1],[1,2],[2,3],[3,4],
                [0,5],[5,6],[6,7],[7,8],
                [0,9],[9,10],[10,11],[11,12],
                [0,13],[13,14],[14,15],[15,16],
                [0,17],[17,18],[18,19],[19,20],
                [5,9],[9,13],[13,17]
            ];

            ctx.strokeStyle = 'rgba(139, 92, 246, 0.6)';
            ctx.lineWidth = 2;
            
            connections.forEach(([start, end]) => {
                const startPoint = landmarks[start];
                const endPoint = landmarks[end];
                
                ctx.beginPath();
                ctx.moveTo(startPoint.x * canvas.width, startPoint.y * canvas.height);
                ctx.lineTo(endPoint.x * canvas.width, endPoint.y * canvas.height);
                ctx.stroke();
            });

            landmarks.forEach((landmark, index) => {
                const x = landmark.x * canvas.width;
                const y = landmark.y * canvas.height;
                
                ctx.beginPath();
                ctx.arc(x, y, index === 0 ? 8 : 4, 0, 2 * Math.PI);
                ctx.fillStyle = index === 0 ? '#8b5cf6' : '#6366f1';
                ctx.fill();
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
        }

        // Word recognition based on hand gestures
        function recognizeWord(landmarks) {
            const fingerTips = [4, 8, 12, 16, 20];
            const fingerBases = [2, 5, 9, 13, 17];
            const wrist = landmarks[0];
            
            // Calculate finger states
            const fingersExtended = fingerTips.map((tip, i) => {
                if (i === 0) {
                    return landmarks[tip].x > landmarks[fingerBases[i]].x + 0.05;
                }
                return landmarks[tip].y < landmarks[fingerBases[i]].y - 0.05;
            });

            const [thumbOut, indexUp, middleUp, ringUp, pinkyUp] = fingersExtended;
            
            // Calculate distances
            const thumbTip = landmarks[4];
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];
            
            const thumbIndexDist = distance(thumbTip, indexTip);
            const thumbMiddleDist = distance(thumbTip, middleTip);
            
            // Gesture recognition patterns for whole words
            
            // Wave (Hello) - open hand with fingers spread
            if (indexUp && middleUp && ringUp && pinkyUp && thumbOut) {
                const fingerSpread = Math.abs(indexTip.x - pinkyTip.x);
                if (fingerSpread > 0.15) return 'Hello';
            }
            
            // Thumbs up (Yes/Good)
            if (thumbOut && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                if (landmarks[4].y < landmarks[2].y) return 'Yes';
            }
            
            // Thumbs down (No/Bad)
            if (thumbOut && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                if (landmarks[4].y > landmarks[2].y) return 'No';
            }
            
            // Peace sign (Peace/Okay)
            if (indexUp && middleUp && !ringUp && !pinkyUp && !thumbOut) {
                return 'Okay';
            }
            
            // Open palm (Stop/Wait)
            if (indexUp && middleUp && ringUp && pinkyUp && !thumbOut) {
                const palmFlat = Math.abs(indexTip.y - pinkyTip.y) < 0.1;
                if (palmFlat) return 'Stop';
            }
            
            // OK sign (Okay/Perfect)
            if (thumbIndexDist < 0.05 && middleUp && ringUp && pinkyUp) {
                return 'Perfect';
            }
            
            // Pointing (You/That)
            if (indexUp && !middleUp && !ringUp && !pinkyUp && !thumbOut) {
                return 'You';
            }
            
            // Closed fist (Strong/Fight)
            if (!thumbOut && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return 'Strong';
            }
            
            // Rock hand (Love)
            if (indexUp && pinkyUp && !middleUp && !ringUp && thumbOut) {
                return 'Love';
            }
            
            // Hang loose (Call/Contact)
            if (thumbOut && pinkyUp && !indexUp && !middleUp && !ringUp) {
                return 'Call';
            }
            
            // Three fingers (Three/Wait)
            if (indexUp && middleUp && ringUp && !pinkyUp && !thumbOut) {
                return 'Wait';
            }
            
            // Point to self (I/Me)
            if (indexUp && !middleUp && !ringUp && !pinkyUp) {
                const pointingToSelf = landmarks[8].x > 0.4 && landmarks[8].x < 0.6;
                if (pointingToSelf) return 'I';
            }
            
            // Hands together approximation (Please/Thanks)
            if (thumbIndexDist < 0.08 && thumbMiddleDist < 0.08) {
                return 'Please';
            }
            
            // Additional gestures
            if (middleUp && !indexUp && !ringUp && !pinkyUp && !thumbOut) {
                return 'Bye';
            }
            
            if (thumbOut && indexUp && !middleUp && !ringUp && !pinkyUp) {
                return 'Help';
            }
            
            return null;
        }

        function distance(p1, p2) {
            return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
        }

        // Handle detected word
        function handleDetectedWord(word) {
            const now = Date.now();
            
            currentWordEl.classList.remove('hidden');
            wordDisplayEl.textContent = word;

            if (word !== lastDetectedWord) {
                lastDetectedWord = word;
                lastDetectionTime = now;
            } else if (now - lastDetectionTime > 1200) {
                if (sentence.length === 0 || sentence[sentence.length - 1] !== word) {
                    addWordToSentence(word);
                    lastDetectionTime = now + 1000;
                }
            }
        }

        // Add word to sentence
        function addWordToSentence(word) {
            if (autoSpaceCheck.checked && sentence.length > 0) {
                sentence.push(word);
            } else {
                sentence.push(word);
            }
            
            updateSentenceDisplay();
            addToHistory(word);
            wordCount++;
            wordCountEl.textContent = wordCount;
            speakBtn.disabled = false;
            
            if (autoSpeakCheck.checked) {
                speakWord(word);
            }
            
            if (vibrateCheck.checked && 'vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // Update sentence display
        function updateSentenceDisplay() {
            if (sentence.length === 0) {
                sentenceDisplay.innerHTML = '<span class="text-gray-500">Start signing to build your sentence...</span>';
            } else {
                sentenceDisplay.textContent = sentence.join(' ');
            }
        }

        // Add to history
        function addToHistory(word) {
            const time = new Date().toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const historyItem = document.createElement('div');
            historyItem.className = 'bg-darker p-3 rounded-lg flex items-center justify-between slide-in';
            historyItem.innerHTML = `
                <div>
                    <div class="font-medium text-sm">${word}</div>
                    <div class="text-xs text-gray-500">${time}</div>
                </div>
                <button onclick="addWordToSentence('${word}')" class="text-purple-400 text-xs hover:text-purple-300">
                    + Add
                </button>
            `;
            
            if (wordHistoryEl.querySelector('.text-gray-500')) {
                wordHistoryEl.innerHTML = '';
            }
            
            wordHistoryEl.insertBefore(historyItem, wordHistoryEl.firstChild);
            
            if (wordHistoryEl.children.length > 20) {
                wordHistoryEl.removeChild(wordHistoryEl.lastChild);
            }
        }

        // Text-to-speech
        function speakWord(word) {
            const rate = parseFloat(speechRateInput.value);
            const selectedVoice = voices[voiceSelect.value];
            
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.rate = rate;
                utterance.pitch = 1;
                utterance.volume = 1;
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function speakSentence() {
            if (sentence.length > 0) {
                const text = sentence.join(' ');
                const rate = parseFloat(speechRateInput.value);
                const selectedVoice = voices[voiceSelect.value];
                
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = rate;
                    utterance.pitch = 1;
                    utterance.volume = 1;
                    if (selectedVoice) {
                        utterance.voice = selectedVoice;
                    }
                    
                    window.speechSynthesis.speak(utterance);
                }
            }
        }

        // Camera controls
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                video.srcObject = stream;
                await video.play();
                
                camera = new Camera(video, {
                    onFrame: async () => {
                        if (isRunning) {
                            await hands.send({ image: video });
                        }
                    },
                    width: 1280,
                    height: 720
                });
                
                await camera.start();
                
                isRunning = true;
                sessionStartTime = Date.now();
                startSessionTimer();
                
                startBtn.disabled = true;
                stopBtn.disabled = false;
                flipBtn.disabled = false;
                
                statusDot.classList.remove('bg-red-500');
                statusDot.classList.add('bg-green-500', 'pulse');
                statusText.textContent = 'Active';
            } catch (error) {
                console.error('Camera error:', error);
                alert('Could not access camera. Please grant permissions.');
            }
        }

        function stopCamera() {
            isRunning = false;
            
            if (camera) {
                camera.stop();
            }
            
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            flipBtn.disabled = true;
            currentWordEl.classList.add('hidden');
            
            statusDot.classList.remove('bg-green-500', 'pulse');
            statusDot.classList.add('bg-yellow-500');
            statusText.textContent = 'Stopped';
        }

        async function flipCamera() {
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            if (isRunning) {
                stopCamera();
                await new Promise(resolve => setTimeout(resolve, 500));
                startCamera();
            }
        }

        // Session timer
        function startSessionTimer() {
            setInterval(() => {
                if (isRunning && sessionStartTime) {
                    const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    sessionTimeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        // Quick phrase functions
        function addQuickPhrase(phrase) {
            sentence.push(...phrase.split(' '));
            updateSentenceDisplay();
            speakBtn.disabled = false;
            
            if (autoSpeakCheck.checked) {
                speakSentence();
            }
            
            if (vibrateCheck.checked && 'vibrate' in navigator) {
                navigator.vibrate(50);
            }
        }

        // Utility functions
        function copyToClipboard() {
            if (sentence.length > 0) {
                const text = sentence.join(' ');
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Copied to clipboard!');
                });
            }
        }

        async function shareText() {
            if (sentence.length > 0) {
                const text = sentence.join(' ');
                if (navigator.share) {
                    try {
                        await navigator.share({ text: text });
                    } catch (err) {
                        copyToClipboard();
                    }
                } else {
                    copyToClipboard();
                }
            }
        }

        function downloadText() {
            if (sentence.length > 0) {
                const text = sentence.join(' ');
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sign-language-${Date.now()}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('Downloaded!');
            }
        }

        function translateText() {
            if (sentence.length > 0) {
                const text = encodeURIComponent(sentence.join(' '));
                window.open(`https://translate.google.com/?sl=auto&tl=en&text=${text}`, '_blank');
            }
        }

        function clearHistory() {
            wordHistoryEl.innerHTML = '<div class="text-sm text-gray-500 text-center py-4">No words detected yet</div>';
        }

        function showToast(message) {
            // Simple toast notification
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-purple-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        }

        // Event listeners
        startBtn.addEventListener('click', startCamera);
        stopBtn.addEventListener('click', stopCamera);
        flipBtn.addEventListener('click', flipCamera);
        speakBtn.addEventListener('click', speakSentence);
        clearSentenceBtn.addEventListener('click', () => {
            sentence = [];
            updateSentenceDisplay();
            speakBtn.disabled = true;
        });

        // Initialize
        window.addEventListener('load', () => {
            initializeMediaPipe();
        });
    </script>
</body>
</html>
